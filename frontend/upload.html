<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <!-- Warning message (hidden by default) -->
  <div id="warningMsg" class="alert alert-warning d-none">
    ⚠️ Data already exists for this module. Uploading new files will overwrite the current data.
  </div>

  <div class="container mt-5">
    <h2 id="uploadTitle" class="mb-3">Upload Files</h2>
    <form method="POST" action="/upload" enctype="multipart/form-data">
      <div id="fileInputs"></div>
      <button class="btn btn-primary">Upload</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const params = new URLSearchParams(window.location.search);
      const module = (params.get('module') || 'COVID-19').trim();

      // ✅ Correctly show warning banner if warn=1
      const warnFlag = params.get('warn');
      if (warnFlag === '1') {
        const warnBox = document.getElementById('warningMsg');
        if (warnBox) warnBox.classList.remove('d-none');
      }

      // ✅ Update title
      document.getElementById('uploadTitle').textContent = `Upload Files for ${module}`;

      const fileInputs = {
        "COVID-19": [
          { name: "contactTracing", label: "Contact Tracing File", required: true },
          { name: "humanMeta", label: "Human Metadata File", required: true }
        ],
        "Dengue": [
          { name: "movement", label: "Movement File", required: true },
          { name: "locationList", label: "Location List File (optional)", required: false }
        ]
      };

      const container = document.getElementById('fileInputs');
      const config = fileInputs[module];

      if (!config) {
        container.innerHTML = `<div class="alert alert-danger">❌ Invalid module: "${module}".</div>`;
        return;
      }

      config.forEach(field => {
        const div = document.createElement('div');
        div.className = 'mb-3';
        div.innerHTML = `
          <label class="form-label">${field.label}</label>
          <input type="file" name="${field.name}" class="form-control"${field.required ? ' required' : ''}>
        `;
        container.appendChild(div);
      });
    });
  </script>
</body>
</html>
